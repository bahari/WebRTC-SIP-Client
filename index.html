<!DOCTYPE html>
<!--
* Copyright (C) 2012-2018 Doubango Telecom <http://www.doubango.org>
* License: BSD
* This file is part of Open Source sipML5 solution <http://www.sipml5.org>
-->
<html>
<!-- head -->
<head>
    <meta charset="utf-8" />
    <title>SCS Call Console</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Keywords" content="doubango, sipML5, VoIP, HTML5, WebRTC, RTCWeb, SIP, IMS, Video chat, VP8, live demo " />
    <meta name="Description" content="HTML5 SIP client using WebRTC framework" />
    <meta name="author" content="Doubango Telecom" />

    <!-- SIPML5 API:
    DEBUG VERSION: 'SIPml-api.js'
    RELEASE VERSION: 'release/SIPml-api.js'
    -->
    <script src="SIPml-api.js?svn=252" type="text/javascript"> </script>

    <!-- Styles -->
    <link href="./assets/css/bootstrap.css" rel="stylesheet" />
    <style type="text/css">
        body {
            padding-top: 80px;
            padding-bottom: 40px;
        }

        .navbar-inner-red {
            background-color: #600000;
            background-image: none;
            background-repeat: no-repeat;
            filter: none;
        }

        .full-screen {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .normal-screen {
            position: relative;
        }

        .call-options {
            padding: 5px;
            background-color: #f0f0f0;
            border: 1px solid #eee;
            border: 1px solid rgba(0, 0, 0, 0.08);
            -webkit-border-radius: 4px;
            -moz-border-radius: 4px;
            border-radius: 4px;
            -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.05);
            -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.05);
            box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.05);
            -webkit-transition-property: opacity;
            -moz-transition-property: opacity;
            -o-transition-property: opacity;
            -webkit-transition-duration: 2s;
            -moz-transition-duration: 2s;
            -o-transition-duration: 2s;
        }

        .tab-video,
        .div-video {
            width: 100%;
            height: 0px;
            -webkit-transition-property: height;
            -moz-transition-property: height;
            -o-transition-property: height;
            -webkit-transition-duration: 2s;
            -moz-transition-duration: 2s;
            -o-transition-duration: 2s;
        }

        .label-align {
            display: block;
            padding-left: 15px;
            text-indent: -15px;
        }

        .input-align {
            width: 13px;
            height: 13px;
            padding: 0;
            margin: 0;
            vertical-align: bottom;
            position: relative;
            top: -1px;
            *overflow: hidden;
        }

        .glass-panel {
            z-index: 99;
            position: fixed;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            top: 0;
            left: 0;
            opacity: 0.8;
            background-color: Gray;
        }

        .div-keypad {
            z-index: 100;
            position: fixed;
            -moz-transition-property: left top;
            -o-transition-property: left top;
            -webkit-transition-duration: 2s;
            -moz-transition-duration: 2s;
            -o-transition-duration: 2s;
        }

        .previewvideo {
            position: absolute;
            width: 88px;
            height: 72px;
            margin-top: -42px;
        }
        
        .blink_call {
            animation: blinker 1s linear infinite;
        }

        @keyframes blinker {  
            50% { opacity: 0; }
        }
    </style>
    <link href="./assets/css/bootstrap-responsive.css" rel="stylesheet" />
    <!-- Le fav and touch icons -->
		<!-- Comments out default ICO for MAB POC -->
    <!--link rel="shortcut icon" href="./assets/ico/favicon.ico" /-->
		<link rel="shortcut icon" href="./assets/ico/scs.ico" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="./assets/ico/apple-touch-icon-114-precomposed.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="./assets/ico/apple-touch-icon-72-precomposed.png" />
    <link rel="apple-touch-icon-precomposed" href="./assets/ico/apple-touch-icon-57-precomposed.png" />

    <script type="text/javascript" src="jquery-1.10.0.min.js"></script>

    <!-- Javascript code -->
    <script type="text/javascript">
        /*
        // Read value from a query string.
        function qs(search_for) {
            var query = window.location.search.substring(1);
            var parms = query.split("&");
            for (var i = 0; i < parms.length; i++) {
                var pos = parms[i].indexOf("=");
                if (pos > 0 && search_for == parms[i].substring(0, pos)) {
                return parms[i].substring(pos + 1);
                }
            }
            return "";
        }

        // Get server end-point from query string.
        var recipient = "";
        if (qs("recipient") !== "") recipient = qs("recipient");
        console.log("recipient=" + recipient);
        */

        // to avoid caching
        //if (window.location.href.indexOf("svn=") == -1) {
        //    window.location.href += (window.location.href.indexOf("?") == -1 ? "svn=236" : "&svn=229");
        //}

        var sTransferNumber;
        var oRingTone, oRingbackTone;
        var oSipStack, oSipSessionRegister, oSipSessionCall, oSipSessionTransferCall;
        var videoRemote, videoLocal, audioRemote;
        var bFullScreen = false;
        var oNotifICall;
        var bDisableVideo = false;
        var viewVideoLocal, viewVideoRemote, viewLocalScreencast; // <video> (webrtc) or <div> (webrtc4all)
        var oConfigCall;
        var oReadyStateTimer;

				// New variable declaration of the SIP server status for MAB POC
				var servConnStatus = false;
				var audioVideoCall = false;

				// Hard coded SIP registration parameters for MAB POC
				// Parameters to create SIP stack
				//var realmIpAddress = "voip.scs.my";
				//var realmIpAddress = "mabpoc.scs.my";
				var realmIpAddress = "mabvoip.scs.my";
				var privIdentity_01 = "6004";
				var privIdentity_02 = "6001";
				var currSelPrivIdent = "";
				var pubIdentity_01 = "sip:" + privIdentity_01 + "@voip.scs.my";
				var pubIdentity_02 = "sip:" + privIdentity_02 + "@voip.scs.my";
				var currSelPubIdent = "";
				var accPswd = "1234";
				var dispName_01 = "Site-01";
				var dispName_02 = "Site-02";
				var currDispName = "";
				var selAccCnt = 0;

        // Variable query string for MAB POC
        // SIP account name - Private Identity
        // Call identity
        // SIP account display name
        var qsPrivIdentity = "";
        var qsPubIdentity = "";
        var qsCallIdentity = "";
        var qsPrivDispName = "";
        // Variable for query string results for MAB Polycom
        var qsPrivIdentRes = false;
        var qsCallIdentRes = false;
        var qsPrivDispNameRes = false;
        //
        var buttonCallClicked = false;
        //
        var buttonVidClicked = false;

				// For secure signalling using TLS: wss://192.168.1.1:8089/ws
				// For un secure signalling: ws://192.168.1.1:8088/ws
				//var webSockProxy = "wss://voip.scs.my/wss";
				//var webSockProxy = "wss://voip.scs.my:8089/ws";
				//var outBoundProxy = "udp://voip.scs.my:5060";
				//var webSockProxy = "wss://mabpoc.scs.my:58089/ws";
				//var outBoundProxy = "udp://mabpoc.scs.my:55060";
				var webSockProxy = "wss://mabvoip.scs.my:58089/ws";
				var outBoundProxy = "udp://mabvoip.scs.my:55060";
				//var iceServers = "[{url:'stun:stun.l.google.com:19302'}]";
				//var iceServers = "[{url:'stun:mabpoc.scs.my:3478'}]";
				var iceServers = "[{url:'stun:mabpocvoip.scs.my:3478'}]";
				//var iceServers = "[{url:'stun:voip.scs.my:3478'}]";
				//var iceServers = "[]";
				var rtcWebBreaker = true;
				var enEarlyIms = true;
				var enMedStreamCache = false;
				var bandWidth = null;
				var videoSize = null;

				/*
				// Hard coded SIP registration parameters for MAB POC
				// Parameters to create SIP stack
				var realmIpAddress = "192.168.189.19";
				var privIdentity_01 = "6001";
				var privIdentity_02 = "6004";
				var currSelPrivIdent = "";
				var pubIdentity_01 = "sip:" + privIdentity_01 + "@192.168.189.19";
				var pubIdentity_02 = "sip:" + privIdentity_02 + "@192.168.189.19";
				var currSelPubIdent = "";
				var accPswd = "1234";
				var dispName_01 = "Site-01";
				var dispName_02 = "Site-02";
				var currDispName = "";
				var selAccCnt = 0;

				// For secure signalling using TLS: wss://192.168.1.1:8089/ws
				// For un secure signalling: ws://192.168.1.1:8088/ws
				var webSockProxy = "wss://192.168.189.19:8089/ws";
				var outBoundProxy = "udp://192.168.189.19:5060";
				//var iceServers = "[{url:'stun:stun.l.google.com:19302'}]";
				var iceServers = null;
				var rtcWebBreaker = false;
				var enEarlyIms = true;
				var enMedStreamCache = false;
				var bandWidth = null;
				var videoSize = null;
				*/

        C =
        {
            divKeyPadWidth: 220
        };

        window.onload = function () {
            window.console && window.console.info && window.console.info("location=" + window.location);

            videoLocal = document.getElementById("video_local");
            videoRemote = document.getElementById("video_remote");
            audioRemote = document.getElementById("audio_remote");

            // txtPhoneNumber = recipient
            //document.getElementById("txtPhoneNumber").value = recipient;

            document.onkeyup = onKeyUp;
            document.body.onkeyup = onKeyUp;
            divCallCtrl.onmousemove = onDivCallCtrlMouseMove;

            // set debug level
            SIPml.setDebugLevel((window.localStorage && window.localStorage.getItem('org.doubango.expert.disable_debug') == "true") ? "error" : "info");

						// Disable this function call for MAB POC
            //loadCredentials();

						// Disable this function call for MAB POC
						//loadCallOptions();

						// Disable this function call for MAB POC
            // Initialize call button
            //uiBtnCallSetText("Call");


            var getPVal = function (PName) {
                var query = window.location.search.substring(1);
                var vars = query.split('&');
                for (var i = 0; i < vars.length; i++) {
                    var pair = vars[i].split('=');
                    if (decodeURIComponent(pair[0]) === PName) {
                        return decodeURIComponent(pair[1]);
                    }
                }
                return null;
            }

            var preInit = function () {
                // set default webrtc type (before initialization)
                var s_webrtc_type = getPVal("wt");
                var s_fps = getPVal("fps");
                var s_mvs = getPVal("mvs"); // maxVideoSize
                var s_mbwu = getPVal("mbwu"); // maxBandwidthUp (kbps)
                var s_mbwd = getPVal("mbwd"); // maxBandwidthUp (kbps)
                var s_za = getPVal("za"); // ZeroArtifacts
                var s_ndb = getPVal("ndb"); // NativeDebug

                if (s_webrtc_type) SIPml.setWebRtcType(s_webrtc_type);

                // initialize SIPML5
                SIPml.init(postInit);

                // set other options after initialization
                if (s_fps) SIPml.setFps(parseFloat(s_fps));
                if (s_mvs) SIPml.setMaxVideoSize(s_mvs);
                if (s_mbwu) SIPml.setMaxBandwidthUp(parseFloat(s_mbwu));
                if (s_mbwd) SIPml.setMaxBandwidthDown(parseFloat(s_mbwd));
                if (s_za) SIPml.setZeroArtifacts(s_za === "true");
                if (s_ndb == "true") SIPml.startNativeDebug();

                //var rinningApps = SIPml.getRunningApps();
                //var _rinningApps = Base64.decode(rinningApps);
                //tsk_utils_log_info(_rinningApps);
            }

            // For MAB POC
            // Read value from a query string.
            function qs(search_for) {
                var query = window.location.search.substring(1);
                var parms = query.split("&");
                for (var i = 0; i < parms.length; i++) {
                    var pos = parms[i].indexOf("=");
                    if (pos > 0 && search_for == parms[i].substring(0, pos)) {
                    return parms[i].substring(pos + 1);
                    }
                }
                return "";
            }

            // For MAB POC
            // Get server end-point from query string.
            // Get call identity
            if (qs("recipient") !== "") {
                qsCallIdentity = qs("recipient");
                document.getElementById("txtPhoneNumber").value = qsCallIdentity;
                qsCallIdentRes = true;
            }
            else {
                qsCallIdentRes = false;
            }
            // Get SIP account name - Private Identity
            if (qs("caller") !== "") {
                qsPrivIdentity = qs("caller");
                //qsPubIdentity = "sip:" + qsPrivIdentity + "@voip.scs.my";
                //qsPubIdentity = "sip:" + qsPrivIdentity + "@mabpoc.scs.my";
                qsPubIdentity = "sip:" + qsPrivIdentity + "@mabvoip.scs.my";
                qsPrivIdentRes = true;
            }
            else {
                qsPrivIdentRes = false;
            }
            // Get SIP account display Name
            if (qs("callername") !== "") {
                qsPrivDispName = qs("callername");
                qsPrivDispNameRes = true;
            }
            else {
                qsPrivDispNameRes = false;
            }

            oReadyStateTimer = setInterval(function () {
                if (document.readyState === "complete") {
                    clearInterval(oReadyStateTimer);
                    // initialize SIPML5
                    preInit();
                    // Comments out - For previous MAB-POC
                    /*
										// Check private, public identity and display name from windows local storage for MAB POC
										currSelPrivIdent = window.localStorage.getItem('sip.private_identity');
										currSelPubIdent = window.localStorage.getItem('sip.public_identity');
										currDispName = window.localStorage.getItem('sip.display_name');

										// Set the SIP account flag availability for MAB POC
										// Local SIP account are empty
										if ((currSelPrivIdent == null) && (currSelPubIdent == null) && (currDispName == null)){
												accountEmpty = false;
										}
										// Local SIP account exists
										else{
												accountEmpty = true;
										}
										// Connect to SIP server for MAB POC
										refreshconnection();
                    */
                    // For a new MAB POC - Query string method
                    // Previously there is a value from query string
                    if ((qsCallIdentRes) && (qsPrivIdentRes) && (qsPrivDispNameRes)) {
                      // callIdentity
                      callIdentity.innerHTML = "[" + qsCallIdentity + "]";

                      // Saved SIP private identity
                      window.localStorage.setItem('sip.private_identity', qsPrivIdentity);
                      // Saved SIP public identity
                      window.localStorage.setItem('sip.public_identity', qsPubIdentity);
                      // Saved SIP display name
                      window.localStorage.setItem('sip.display_name', qsPrivDispName);
                        refreshconnection();
                    }
                    // Show notification
                    else {
                        txtRegStatus.innerHTML = "<i>" + "Server Status: ❌</i>";
                    }
                }
            },
            500);

            /*if (document.readyState === "complete") {
                preInit();
            }
            else {
                document.onreadystatechange = function () {
                     if (document.readyState === "complete") {
                        preInit();
                    }
                }
           }*/
        };

        function postInit() {
            // check for WebRTC support
            if (!SIPml.isWebRtcSupported()) {
                // is it chrome?
                if (SIPml.getNavigatorFriendlyName() == 'chrome') {
                    if (confirm("You're using an old Chrome version or WebRTC is not enabled.\nDo you want to see how to enable WebRTC?")) {
                        window.location = 'http://www.webrtc.org/running-the-demos';
                    }
                    else {
                        window.location = "index.html";
                    }
                    return;
                }
                else {
                    if (confirm("webrtc-everywhere extension is not installed. Do you want to install it?\nIMPORTANT: You must restart your browser after the installation.")) {
                        window.location = 'https://github.com/sarandogou/webrtc-everywhere';
                    }
                    else {
                        // Must do nothing: give the user the chance to accept the extension
                        // window.location = "index.html";
                    }
                }
            }

            // checks for WebSocket support
            if (!SIPml.isWebSocketSupported()) {
                if (confirm('Your browser don\'t support WebSockets.\nDo you want to download a WebSocket-capable browser?')) {
                    window.location = 'https://www.google.com/intl/en/chrome/browser/';
                }
                else {
                    window.location = "index.html";
                }
                return;
            }

            // FIXME: displays must be per session
            viewVideoLocal = videoLocal;
            viewVideoRemote = videoRemote;

            if (!SIPml.isWebRtcSupported()) {
                if (confirm('Your browser don\'t support WebRTC.\naudio/video calls will be disabled.\nDo you want to download a WebRTC-capable browser?')) {
                    window.location = 'https://www.google.com/intl/en/chrome/browser/';
                }
            }

						// Comments out for MAB POC
            //btnRegister.disabled = false;

						document.body.style.cursor = 'default';
            oConfigCall = {
                audio_remote: audioRemote,
                video_local: viewVideoLocal,
                video_remote: viewVideoRemote,
                screencast_window_id: 0x00000000, // entire desktop
                bandwidth: { audio: undefined, video: undefined },
                video_size: { minWidth: undefined, minHeight: undefined, maxWidth: undefined, maxHeight: undefined },
                events_listener: { events: '*', listener: onSipEventSession },
                sip_caps: [
                                { name: '+g.oma.sip-im' },
                                { name: 'language', value: '\"en,fr\"' }
                ]
            };
        }


        function loadCallOptions() {
            if (window.localStorage) {
                var s_value;
                if ((s_value = window.localStorage.getItem('org.doubango.call.phone_number'))) txtPhoneNumber.value = s_value;
                bDisableVideo = (window.localStorage.getItem('org.doubango.expert.disable_video') == "true");

                txtCallStatus.innerHTML = '<i>Video ' + (bDisableVideo ? 'disabled' : 'enabled') + '</i>';
            }
        }

        function saveCallOptions() {
            if (window.localStorage) {
                window.localStorage.setItem('org.doubango.call.phone_number', txtPhoneNumber.value);
                window.localStorage.setItem('org.doubango.expert.disable_video', bDisableVideo ? "true" : "false");
            }
        }

        function loadCredentials() {
            if (window.localStorage) {
                // IE retuns 'null' if not defined
                var s_value;
                if ((s_value = window.localStorage.getItem('org.doubango.identity.display_name'))) txtDisplayName.value = s_value;
                if ((s_value = window.localStorage.getItem('org.doubango.identity.impi'))) txtPrivateIdentity.value = s_value;
                if ((s_value = window.localStorage.getItem('org.doubango.identity.impu'))) txtPublicIdentity.value = s_value;
                if ((s_value = window.localStorage.getItem('org.doubango.identity.password'))) txtPassword.value = s_value;
                if ((s_value = window.localStorage.getItem('org.doubango.identity.realm'))) txtRealm.value = s_value;
            }
            else {
                //txtDisplayName.value = "005";
                //txtPrivateIdentity.value = "005";
                //txtPublicIdentity.value = "sip:005@sip2sip.info";
                //txtPassword.value = "005";
                //txtRealm.value = "sip2sip.info";
                //txtPhoneNumber.value = "701020";
            }
        };

        function saveCredentials() {
            if (window.localStorage) {
                window.localStorage.setItem('org.doubango.identity.display_name', txtDisplayName.value);
                window.localStorage.setItem('org.doubango.identity.impi', txtPrivateIdentity.value);
                window.localStorage.setItem('org.doubango.identity.impu', txtPublicIdentity.value);
                window.localStorage.setItem('org.doubango.identity.password', txtPassword.value);
                window.localStorage.setItem('org.doubango.identity.realm', txtRealm.value);
            }
        };

				// Automatic SIP server initiate connection for MAB POC
				function refreshconnection(){
            //uiBtnCallSetText('Call');
            //New features for MAB POC
            uiBtnCallSetText('');

            if (!servConnStatus){
								sipRegister();

								setTimeout(registerTimeOut, 10000);
								//txtRegStatus.innerHTML = '<i>Server Status: Server registration start....</i>';
                                txtRegStatus.innerHTML = '<i> Server Status: ⌛';
						}
						else{
								sipUnRegister();
						}
				}

				// Server registration time out for MAB POC
				function registerTimeOut(){
						// SIP registration still failed after 10s
						if (!servConnStatus){
								// txtRegStatus.innerHTML = '<i>Server Status: Server registration failed!</i>';
                                txtRegStatus.innerHTML = '<i>Server Status: ❌</i>';
								// Initiate 3s timer before execute SIP unregister process
								setTimeout(delayToUnregister, 3000);
						}
				}

				// Delay for 3s before unregister server upon server registration failed for MAB POC
				function delayToUnregister(){
						if (oSipStack) {
								oSipStack.stop(); // shutdown all sessions
						}
						refreshconnection();
				}

				// Delay for 5s before execute SIP registration process for MAB POC
				function delayBeforeRegister(){
						refreshconnection();
				}

        // sends SIP REGISTER request to login
        function sipRegister() {
            // catch exception for IE (DOM not ready)
            try {
								/* Comments out this code segment for MAB POC
                btnRegister.disabled = true;
                if (!txtRealm.value || !txtPrivateIdentity.value || !txtPublicIdentity.value) {
                    txtRegStatus.innerHTML = '<b>Please fill madatory fields (*)</b>';
                    btnRegister.disabled = false;
                    return;
                }
                var o_impu = tsip_uri.prototype.Parse(txtPublicIdentity.value);
                if (!o_impu || !o_impu.s_user_name || !o_impu.s_host) {
                    txtRegStatus.innerHTML = "<b>[" + txtPublicIdentity.value + "] is not a valid Public identity</b>";
                    btnRegister.disabled = false;
                    return;
                }

                // enable notifications if not already done
                if (window.webkitNotifications && window.webkitNotifications.checkPermission() != 0) {
                    window.webkitNotifications.requestPermission();
                }

                // save credentials
                saveCredentials();

                // update debug level to be sure new values will be used if the user haven't updated the page
                SIPml.setDebugLevel((window.localStorage && window.localStorage.getItem('org.doubango.expert.disable_debug') == "true") ? "error" : "info");
								*/

                // Comments out - For previous MAB POC
                /*
								// Previously local SIP account are empty - For MAB POC
								// Search the empty SIP account
								if (accountEmpty == false){
										// First SIP account if available
										if (selAccCnt == 0){
												currSelPrivIdent = privIdentity_01;
												currSelPubIdent = pubIdentity_01;
												currDispName = dispName_01;

												selAccCnt = 1;
										}
										// Search for second SIP account if available
										else{
												currSelPrivIdent = privIdentity_02;
												currSelPubIdent = pubIdentity_02;
												currDispName = dispName_02;

												selAccCnt = 0;
										}
								}
                */
                // For a new MAB POC - Query string method
                // Previously there is a value from query string
                // ***NO NEED todo this actually, just for FUN.....ha...ha....ha
                if ((qsCallIdentRes) && (qsPrivIdentRes) && (qsPrivDispNameRes)) {
                    currSelPrivIdent = qsPrivIdentity;
                    currSelPubIdent = qsPubIdentity;
                    currDispName = qsPrivDispName;
                }
								// create SIP stack
								oSipStack = new SIPml.Stack({
												realm: realmIpAddress,
												//impi: privIdentity_01,
												//impu: pubIdentity_01,
												impi: currSelPrivIdent,
												impu: currSelPubIdent,
												password: accPswd,
												//display_name: dispName_01,
												display_name: currDispName,
												websocket_proxy_url: webSockProxy,
												outbound_proxy_url: outBoundProxy,
												//ice_servers: "[{url:'stun:stun.l.google.com:19302'}]",
												ice_servers: iceServers,
												enable_rtcweb_breaker: rtcWebBreaker,
												events_listener: { events: '*', listener: onSipEventStack },
												enable_early_ims: enEarlyIms, // Must be true unless you're using a real IMS network
												enable_media_stream_cache: enMedStreamCache,
												bandwidth: bandWidth, // could be redefined a session-level
												video_size: videoSize, // could be redefined a session-level
												sip_headers: [
																{ name: 'User-Agent', value: 'IM-client/OMA1.0 sipML5-v1.2015.03.18' },
																{ name: 'Organization', value: 'Doubango Telecom' }
												]
										}
								);
								/* Comments out this code segment for MAB POC
                // create SIP stack
                oSipStack = new SIPml.Stack({
                    realm: txtRealm.value,
                    impi: txtPrivateIdentity.value,
                    impu: txtPublicIdentity.value,
                    password: txtPassword.value,
                    display_name: txtDisplayName.value,
                    websocket_proxy_url: (window.localStorage ? window.localStorage.getItem('org.doubango.expert.websocket_server_url') : null),
                    outbound_proxy_url: (window.localStorage ? window.localStorage.getItem('org.doubango.expert.sip_outboundproxy_url') : null),
                    ice_servers: (window.localStorage ? window.localStorage.getItem('org.doubango.expert.ice_servers') : null),
                    enable_rtcweb_breaker: (window.localStorage ? window.localStorage.getItem('org.doubango.expert.enable_rtcweb_breaker') == "true" : false),
                    events_listener: { events: '*', listener: onSipEventStack },
                    enable_early_ims: (window.localStorage ? window.localStorage.getItem('org.doubango.expert.disable_early_ims') != "true" : true), // Must be true unless you're using a real IMS network
                    enable_media_stream_cache: (window.localStorage ? window.localStorage.getItem('org.doubango.expert.enable_media_caching') == "true" : false),
                    bandwidth: (window.localStorage ? tsk_string_to_object(window.localStorage.getItem('org.doubango.expert.bandwidth')) : null), // could be redefined a session-level
                    video_size: (window.localStorage ? tsk_string_to_object(window.localStorage.getItem('org.doubango.expert.video_size')) : null), // could be redefined a session-level
                    sip_headers: [
                            { name: 'User-Agent', value: 'IM-client/OMA1.0 sipML5-v1.2016.03.04' },
                            { name: 'Organization', value: 'Doubango Telecom' }
                    ]
                }
                );
								*/
                if (oSipStack.start() != 0) {
                    txtRegStatus.innerHTML = '<b>Failed to start the SIP stack</b>';
                }
                else return;
            }
            catch (e) {
                txtRegStatus.innerHTML = "<b>2:" + e + "</b>";
            }
						// Comments out for MAB POC
            //btnRegister.disabled = false;
        }

        // sends SIP REGISTER (expires=0) to logout
        function sipUnRegister() {
            if (oSipStack) {
                oSipStack.stop(); // shutdown all sessions
            }
        }
        // New features for MAB POC
        // Call back function for audio call command button
        jQuery(document).ready(function() {
            $('#btnCall').click(function() {
                buttonCallClicked = true;
                sipCall("call-audio");
            });
        });
        // New features for MAB POC
        // Call back function for audio-video call command button
        jQuery(document).ready(function() {
            $('#btnVideoCall').click(function() {
                buttonVidClicked = true;
                sipCall("call-audiovideo");
            });
        });

        // makes a call (SIP INVITE)
        function sipCall(s_type) {
					  var videoCallOpt = false;

            if (oSipStack && !oSipSessionCall && !tsk_string_is_null_or_empty(txtPhoneNumber.value)) {
                if (s_type == 'call-screenshare') {
                    if (!SIPml.isScreenShareSupported()) {
                        alert('Screen sharing not supported. Are you using chrome 26+?');
                        return;
                    }
                    if (!location.protocol.match('https')) {
                        if (confirm("Screen sharing requires https://. Do you want to be redirected?")) {
                            sipUnRegister();
                            window.location = 'https://ns313841.ovh.net/call.htm';
                        }
                        return;
                    }
                }

								btnCall.disabled = true;
                // New features for MAB POC
                btnVideoCall.disabled = true;

                btnHangUp.disabled = false;

                if (window.localStorage) {
                    oConfigCall.bandwidth = tsk_string_to_object(window.localStorage.getItem('org.doubango.expert.bandwidth')); // already defined at stack-level but redifined to use latest values
                    oConfigCall.video_size = tsk_string_to_object(window.localStorage.getItem('org.doubango.expert.video_size')); // already defined at stack-level but redifined to use latest values
                }
                /*
                // create call session
								videoCallOpt = cbVideoCall.checked;
								if (videoCallOpt){
										s_type = "call-audiovideo";
								}
								else{

										s_type = "call-audio";
								}
                */
                // New features for MAB POC
                // Audio call
                if (buttonCallClicked) {
                    s_type = "call-audio";
                    buttonCallClicked = false;
                }
                // Video call
                else if (buttonVidClicked) {
                    s_type = "call-audiovideo";
                    buttonVidClicked = false;
                }
                oSipSessionCall = oSipStack.newSession(s_type, oConfigCall);
                // make call
                if (oSipSessionCall.call(txtPhoneNumber.value) != 0) {
                    oSipSessionCall = null;
                    txtCallStatus.value = 'Failed to make call';

										btnCall.disabled = false;
                    // New features for MAb POC
                    btnVideoCall.disabled = false;

										btnHangUp.disabled = true;
                    return;
                }
                saveCallOptions();
            }
            // Accept incoming call
            else if (oSipSessionCall) {
                // Add new features for MAB POC
                buttonCallClicked = false;
                buttonVidClicked = false;

                txtCallStatus.innerHTML = '<i>Connecting...</i>';
                oSipSessionCall.accept(oConfigCall);
            }
        }

        // Share entire desktop aor application using BFCP or WebRTC native implementation
        function sipShareScreen() {
            if (SIPml.getWebRtcType() === 'w4a') {
                // Sharing using BFCP -> requires an active session
                if (!oSipSessionCall) {
                    txtCallStatus.innerHTML = '<i>No active session</i>';
                    return;
                }
                if (oSipSessionCall.bfcpSharing) {
                    if (oSipSessionCall.stopBfcpShare(oConfigCall) != 0) {
                        txtCallStatus.value = 'Failed to stop BFCP share';
                    }
                    else {
                        oSipSessionCall.bfcpSharing = false;
                    }
                }
                else {
                    oConfigCall.screencast_window_id = 0x00000000;
                    if (oSipSessionCall.startBfcpShare(oConfigCall) != 0) {
                        txtCallStatus.value = 'Failed to start BFCP share';
                    }
                    else {
                        oSipSessionCall.bfcpSharing = true;
                    }
                }
            }
            else {
                sipCall('call-screenshare');
            }
        }

        // transfers the call
        function sipTransfer() {
            if (oSipSessionCall) {
                var s_destination = prompt('Enter destination number', '');
                if (!tsk_string_is_null_or_empty(s_destination)) {
                    btnTransfer.disabled = true;
                    if (oSipSessionCall.transfer(s_destination) != 0) {
                        txtCallStatus.innerHTML = '<i>Call transfer failed</i>';
                        btnTransfer.disabled = false;
                        return;
                    }
                    txtCallStatus.innerHTML = '<i>Transfering the call...</i>';
                }
            }
        }

        // holds or resumes the call
        function sipToggleHoldResume() {
            if (oSipSessionCall) {
                var i_ret;
                btnHoldResume.disabled = true;
                txtCallStatus.innerHTML = oSipSessionCall.bHeld ? '<i>Resuming the call...</i>' : '<i>Holding the call...</i>';
                i_ret = oSipSessionCall.bHeld ? oSipSessionCall.resume() : oSipSessionCall.hold();
                if (i_ret != 0) {
                    txtCallStatus.innerHTML = '<i>Hold / Resume failed</i>';
                    btnHoldResume.disabled = false;
                    return;
                }
            }
        }

        // Mute or Unmute the call
        function sipToggleMute() {
            if (oSipSessionCall) {
                var i_ret;
                var bMute = !oSipSessionCall.bMute;
                txtCallStatus.innerHTML = bMute ? '<i>Mute the call...</i>' : '<i>Unmute the call...</i>';
                i_ret = oSipSessionCall.mute('audio'/*could be 'video'*/, bMute);
                if (i_ret != 0) {
                    txtCallStatus.innerHTML = '<i>Mute / Unmute failed</i>';
                    return;
                }
                oSipSessionCall.bMute = bMute;
                btnMute.value = bMute ? "Unmute" : "Mute";
            }
        }

        // terminates the call (SIP BYE or CANCEL)
        function sipHangUp() {
            if (oSipSessionCall) {
                txtCallStatus.innerHTML = '<i>Terminating the call...</i>';
                oSipSessionCall.hangup({ events_listener: { events: '*', listener: onSipEventSession } });
            }
        }

        function sipSendDTMF(c) {
            if (oSipSessionCall && c) {
                if (oSipSessionCall.dtmf(c) == 0) {
                    try { dtmfTone.play(); } catch (e) { }
                }
            }
        }

        function startRingTone() {
            try { ringtone.play(); }
            catch (e) { }
        }

        function stopRingTone() {
            try { ringtone.pause(); }
            catch (e) { }
        }

        function startRingbackTone() {
            try { ringbacktone.play(); }
            catch (e) { }
        }

        function stopRingbackTone() {
            try { ringbacktone.pause(); }
            catch (e) { }
        }

        function toggleFullScreen() {
            if (videoRemote.webkitSupportsFullscreen) {
                fullScreen(!videoRemote.webkitDisplayingFullscreen);
            }
            else {
                fullScreen(!bFullScreen);
            }
        }

        function openKeyPad() {
            divKeyPad.style.visibility = 'visible';
            divKeyPad.style.left = ((document.body.clientWidth - C.divKeyPadWidth) >> 1) + 'px';
            divKeyPad.style.top = '70px';
            divGlassPanel.style.visibility = 'visible';
        }

        function closeKeyPad() {
            divKeyPad.style.left = '0px';
            divKeyPad.style.top = '0px';
            divKeyPad.style.visibility = 'hidden';
            divGlassPanel.style.visibility = 'hidden';
        }

        function fullScreen(b_fs) {
            bFullScreen = b_fs;
            if (tsk_utils_have_webrtc4native() && bFullScreen && videoRemote.webkitSupportsFullscreen) {
                if (bFullScreen) {
                    videoRemote.webkitEnterFullScreen();
                }
                else {
                    videoRemote.webkitExitFullscreen();
                }
            }
            else {
                if (tsk_utils_have_webrtc4npapi()) {
                    try { if (window.__o_display_remote) window.__o_display_remote.setFullScreen(b_fs); }
                    catch (e) { divVideo.setAttribute("class", b_fs ? "full-screen" : "normal-screen"); }
                }
                else {
                    divVideo.setAttribute("class", b_fs ? "full-screen" : "normal-screen");
                }
            }
        }

        function showNotifICall(s_number) {
            // permission already asked when we registered
            if (window.webkitNotifications && window.webkitNotifications.checkPermission() == 0) {
                if (oNotifICall) {
                    oNotifICall.cancel();
                }
                oNotifICall = window.webkitNotifications.createNotification('images/sipml-34x39.png', 'Incoming call', 'Incoming call from ' + s_number);
                oNotifICall.onclose = function () { oNotifICall = null; };
                oNotifICall.show();
            }
        }

        function onKeyUp(evt) {
            evt = (evt || window.event);
            if (evt.keyCode == 27) {
                fullScreen(false);
            }
            else if (evt.ctrlKey && evt.shiftKey) { // CTRL + SHIFT
                if (evt.keyCode == 65 || evt.keyCode == 86) { // A (65) or V (86)
                    bDisableVideo = (evt.keyCode == 65);
                    txtCallStatus.innerHTML = '<i>Video ' + (bDisableVideo ? 'disabled' : 'enabled') + '</i>';
                    window.localStorage.setItem('org.doubango.expert.disable_video', bDisableVideo);
                }
            }
        }

        function onDivCallCtrlMouseMove(evt) {
            try { // IE: DOM not ready
                if (tsk_utils_have_stream()) {
										btnCall.disabled = (!tsk_utils_have_stream() || !oSipSessionRegister || !oSipSessionRegister.is_connected());
                    // New features for MAB POC
                    btnVideoCall.disabled = (!tsk_utils_have_stream() || !oSipSessionRegister || !oSipSessionRegister.is_connected());

                    document.getElementById("divCallCtrl").onmousemove = null; // unsubscribe
                }
            }
            catch (e) { }
        }

        function uiOnConnectionEvent(b_connected, b_connecting) { // should be enum: connecting, connected, terminating, terminated
            // Comments out for MAB POC
						//btnRegister.disabled = b_connected || b_connecting;
            // Comments out for MAB POC
						//btnUnRegister.disabled = !b_connected && !b_connecting;
            btnCall.disabled = !(b_connected && tsk_utils_have_webrtc() && tsk_utils_have_stream());
            // New features for MAB POC
            btnVideoCall.disabled = !(b_connected && tsk_utils_have_webrtc() && tsk_utils_have_stream());

            btnHangUp.disabled = !oSipSessionCall;
        }

        function uiVideoDisplayEvent(b_local, b_added) {
            var o_elt_video = b_local ? videoLocal : videoRemote;

            if (b_added) {
                o_elt_video.style.opacity = 1;
                uiVideoDisplayShowHide(true);
            }
            else {
                o_elt_video.style.opacity = 0;
                fullScreen(false);
            }
        }

        function uiVideoDisplayShowHide(b_show) {
            if (b_show) {
                tdVideo.style.height = '340px';
                divVideo.style.height = navigator.appName == 'Microsoft Internet Explorer' ? '100%' : '340px';
            }
            else {
                tdVideo.style.height = '0px';
                divVideo.style.height = '0px';
            }
						// Commands out for MAB POC
            //btnFullScreen.disabled = !b_show;
        }

        function uiDisableCallOptions() {
            if (window.localStorage) {
                window.localStorage.setItem('org.doubango.expert.disable_callbtn_options', 'true');
								// Disable this function call for MAB POC
                //uiBtnCallSetText('Call');
                alert('Use expert view to enable the options again (/!\\requires re-loading the page)');
            }
        }

				// New initialization of the button call text value for MOB POC
        // Add no value switch value - New features for MAB POC
				function uiBtnCallSetText(s_text) {
						switch(s_text) {
								case "Call":
										btnCall.value = btnCall.innerHTML = "       Call       ";
										break;
                default:
										if (s_text == "Answer"){
												btnCall.value = btnCall.innerHTML = "      Answer      ";
										}
										break;
						}
				}
        /* Disable this function for MAB POC
        function uiBtnCallSetText(s_text) {
            switch (s_text) {
                case "Call":
                    {
                        var bDisableCallBtnOptions = (window.localStorage && window.localStorage.getItem('org.doubango.expert.disable_callbtn_options') == "true");
                        btnCall.value = btnCall.innerHTML = bDisableCallBtnOptions ? 'Call' : 'Call <span id="spanCaret" class="caret">';
                        btnCall.setAttribute("class", bDisableCallBtnOptions ? "btn btn-primary" : "btn btn-primary dropdown-toggle");
                        btnCall.onclick = bDisableCallBtnOptions ? function () { sipCall(bDisableVideo ? 'call-audio' : 'call-audiovideo'); } : null;
                        ulCallOptions.style.visibility = bDisableCallBtnOptions ? "hidden" : "visible";
                        if (!bDisableCallBtnOptions && ulCallOptions.parentNode != divBtnCallGroup) {
                            divBtnCallGroup.appendChild(ulCallOptions);
                        }
                        else if (bDisableCallBtnOptions && ulCallOptions.parentNode == divBtnCallGroup) {
                            document.body.appendChild(ulCallOptions);
                        }

                        break;
                    }
                default:
                    {
                        btnCall.value = btnCall.innerHTML = s_text;
                        btnCall.setAttribute("class", "btn btn-primary");
                        btnCall.onclick = function () { sipCall(bDisableVideo ? 'call-audio' : 'call-audiovideo'); };
                        ulCallOptions.style.visibility = "hidden";
                        if (ulCallOptions.parentNode == divBtnCallGroup) {
                            document.body.appendChild(ulCallOptions);
                        }
                        break;
                    }
            }
        }
				*/

        function uiCallTerminated(s_description) {
            //uiBtnCallSetText("Call");
            //New features for MAB POC
            uiBtnCallSetText('');
            btnHangUp.value = 'HangUp';
            btnHoldResume.value = 'Hold';
            //btnMute.value = "Mute";
            //btnMute.value = <svg id="svgPhone" width="20" height="20" fill="currentColor"class="bi bi-telephone-fill" viewBox="0 0 16 16"><path fill-rule="evenodd"d="M1.885.511a1.745 1.745 0 012.61.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 00.178.643l2.457 2.457a.678.678 0 00.644.178l2.189-.547a1.745 1.745 0 011.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 01-7.01-4.42 18.634 18.634 0 01-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511z" /></svg>;

            btnCall.disabled = false;
            // New features for MAB POC
            btnVideoCall.disabled = false;

            btnHangUp.disabled = true;
            if (window.btnBFCP) window.btnBFCP.disabled = true;

            oSipSessionCall = null;

            document.getElementById("divCallOptions").style.display = "none";
            document.getElementById("divCallChoices").style.display = "inline-flex";
            // document.getElementById("btnCall").classList.remove("btn-glow");
            // document.getElementById("btnCall").className = "btn-success";
            // document.getElementById("btnVideoCall").classList.remove("btn-glow");
            // document.getElementById("btnVideoCall").className = "btn-success";
            stopRingbackTone();
            stopRingTone();

            txtCallStatus.innerHTML = "<i>" + s_description + "</i>";
            uiVideoDisplayShowHide(false);
            //divCallOptions.style.opacity = 0;

            if (oNotifICall) {
                oNotifICall.cancel();
                oNotifICall = null;
            }

            uiVideoDisplayEvent(false, false);
            uiVideoDisplayEvent(true, false);

            setTimeout(function () { if (!oSipSessionCall) txtCallStatus.innerHTML = ''; }, 2500);
        }

        // Callback function for SIP Stacks
        function onSipEventStack(e /*SIPml.Stack.Event*/) {
            tsk_utils_log_info('==stack event = ' + e.type);
            switch (e.type) {
                case 'started':
                    {
                        // catch exception for IE (DOM not ready)
                        try {
                            // LogIn (REGISTER) as soon as the stack finish starting
                            oSipSessionRegister = this.newSession('register', {
                                expires: 200,
                                events_listener: { events: '*', listener: onSipEventSession },
                                sip_caps: [
                                            { name: '+g.oma.sip-im', value: null },
                                            //{ name: '+sip.ice' }, // rfc5768: FIXME doesn't work with Polycom TelePresence
                                            { name: '+audio', value: null },
                                            { name: 'language', value: '\"en,fr\"' }
                                ]
                            });
                            oSipSessionRegister.register();
                        }
                        catch (e) {
														// Comments out for MAB POC
                            //txtRegStatus.value = txtRegStatus.innerHTML = "<b>1:" + e + "</b>";
                            //btnRegister.disabled = false;
														txtRegStatus.value = txtRegStatus.innerHTML = "<b>1:" + "Server Status: " + e + "</b>";
                        }
                        break;
                    }
                case 'stopping': case 'stopped': case 'failed_to_start': case 'failed_to_stop':
                    {
                        var bFailure = (e.type == 'failed_to_start') || (e.type == 'failed_to_stop');
                        oSipStack = null;
                        oSipSessionRegister = null;
                        oSipSessionCall = null;

                        uiOnConnectionEvent(false, false);

                        // document.getElementById("btnCall").classList.remove("btn-glow");
                        // document.getElementById("btnCall").className = "btn-success";
                        // document.getElementById("btnVideoCall").classList.remove("btn-glow");
                        // document.getElementById("btnVideoCall").className = "btn-success";

                        stopRingbackTone();
                        stopRingTone();

                        uiVideoDisplayShowHide(false);
                        divCallOptions.style.opacity = 0;

                        txtCallStatus.innerHTML = '';
                        txtRegStatus.innerHTML = bFailure ? "<i>Server Status: ❌</i>" : "<i>Server Status: ❌</i>";
                        // txtRegStatus.innerHTML = bFailure ? "<i>Disconnected: <b>" + e.description + "</b></i>" : "<i>Disconnected:</i>";

												// Clear the SIP server status flag for MOB POC
												servConnStatus = false;
												// Delay 5s before execute back SIP registration process
												setTimeout(delayBeforeRegister, 5000);
                        break;
                    }

                case 'i_new_call':
                    {
                        if (oSipSessionCall) {
                            // do not accept the incoming call if we're already 'in call'
                            e.newSession.hangup(); // comment this line for multi-line support
                        }
                        else {
                            oSipSessionCall = e.newSession;
                            // start listening for events
                            oSipSessionCall.setConfiguration(oConfigCall);
                            // Comments out for new features for MAB POC
                            //uiBtnCallSetText('Answer');
                            document.getElementById("divCallOptions").style.display ="inline";
                            btnHangUp.value = 'Reject';

                            btnCall.disabled = false;

                            // New features for MAB POC
                            btnVideoCall.disabled = false;

														btnHangUp.disabled = false;
                                                        //Specific Button glows depending on call type
                            //                             if (s_type == "call-audio") {
                            //     document.getElementById("btnCall").classList.remove("btn-success");
                            //     document.getElementById("btnCall").className = "btn-glow";
                            // } else if (s_type == "call-audiovideo") {
                            //     document.getElementById("btnVideoCall").classList.remove("btn-success");
                            //     document.getElementById("btnVideoCall").className = "btn-glow";
                            // }

                            startRingTone();
                            $("#btnCall").fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100);
                            $("#btnVideoCall").fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100);

                            var sRemoteNumber = (oSipSessionCall.getRemoteFriendlyName() || 'unknown');
                            txtCallStatus.innerHTML = "<i>Incoming call from [<b>" + sRemoteNumber + "</b>]</i>";
                            showNotifICall(sRemoteNumber);
                        }
                        break;
                    }

                case 'm_permission_requested':
                    {
                        divGlassPanel.style.visibility = 'visible';
                        break;
                    }
                case 'm_permission_accepted':
                case 'm_permission_refused':
                    {
                        divGlassPanel.style.visibility = 'hidden';
                        if (e.type == 'm_permission_refused') {
                            uiCallTerminated('Media stream permission denied');
                        }
                        break;
                    }

                case 'starting': default: break;
            }
        };

        // Callback function for SIP sessions (INVITE, REGISTER, MESSAGE...)
        function onSipEventSession(e /* SIPml.Session.Event */) {
            tsk_utils_log_info('==session event = ' + e.type);

            switch (e.type) {
                case 'connecting': case 'connected':
                    {
                        var bConnected = (e.type == 'connected');
                        if (e.session == oSipSessionRegister) {
                            uiOnConnectionEvent(bConnected, !bConnected);
                            // Comments out for MAB POC
														//txtRegStatus.innerHTML = "<i>" + e.description + "</i>";

														// For MAB POC
														// txtRegStatus.innerHTML = "<i>" + "Server Status: " + e.description + "</i>";
                                                        txtRegStatus.innerHTML = "<i>" + "Server Status: ✔️" + "</i>";

														var connStatus = '';
														connStatus = e.type;
														// SIP server connected, set the flag
														if (connStatus == 'connected'){
																servConnStatus = true;

																// txtRegStatus.innerHTML = "<i>" + "Server Status: " + e.description + " ["+ currSelPrivIdent + "]"+ "</i>";
                                                                txtRegStatus.innerHTML = "<i>" + "Server Status: ✔️" + "</i>";

																// Temporarily logic for MAB POC
																// Stored the SIP account to the local storage
                                // Comments out - For previous MAB-POC
                                /*
																if (!accountEmpty){
																		// Saved SIP private identity
																		window.localStorage.setItem('sip.private_identity', currSelPrivIdent);
																		// Saved SIP public identity
																		window.localStorage.setItem('sip.public_identity', currSelPubIdent);
																		// Saved SIP display name
																		window.localStorage.setItem('sip.display_name', currDispName);

																		accountEmpty = true;
																}
                                */
														}
												}
                        else if (e.session == oSipSessionCall) {
                            btnHangUp.value = 'HangUp';

                            btnCall.disabled = true;
                            // New features for MAB POC
                            btnVideoCall.disabled = true;

														btnHangUp.disabled = false;
                            btnTransfer.disabled = false;
                            if (window.btnBFCP) window.btnBFCP.disabled = false;

                            if (bConnected) {
                                //changes button back when call is answered
                                // document.getElementById("btnCall").classList.remove("btn-glow");
                                // document.getElementById("btnCall").className = "btn-success";
                                // document.getElementById("btnVideoCall").classList.remove("btn-glow");
                                // document.getElementById("btnVideoCall").className = "btn-success";
                                document.getElementById("divCallOptions").style.display ="inline";
                                document.getElementById("divCallChoices").style.display ="none";

                                stopRingbackTone();
                                stopRingTone();

                                if (oNotifICall) {
                                    oNotifICall.cancel();
                                    oNotifICall = null;
                                }
                            }

                            txtCallStatus.innerHTML = "<i>" + e.description + "</i>";
                            // Comments out for new features of MAB POC
                            // No need to show this panel
                            //divCallOptions.style.opacity = bConnected ? 1 : 0;
                            // document.getElementById("divCallOptions").style.display = bConnected ? "inline" : "none";
                            // document.getElementById("divCallChoices").style.display = bConnected ? "none" : "inline-flex";

                            if (SIPml.isWebRtc4AllSupported()) { // IE don't provide stream callback
                                uiVideoDisplayEvent(false, true);
                                uiVideoDisplayEvent(true, true);
                            }
                        }
                        break;
                    } // 'connecting' | 'connected'
                case 'terminating': case 'terminated':
                    {
                        if (e.session == oSipSessionRegister) {
                            uiOnConnectionEvent(false, false);

                            oSipSessionCall = null;
                            oSipSessionRegister = null;

														// Comments out for MAB POC
                            // txtRegStatus.innerHTML = "<i>" + e.description + "</i>";
                            txtRegStatus.innerHTML = "<i>❌</i>";

														// For MAB POC
														// txtRegStatus.innerHTML = "<i>" + "Server Status: " + e.description + "</i>";
                                                        txtRegStatus.innerHTML = "<i>" + "Server Status: ❌</i>";
                        }
                        else if (e.session == oSipSessionCall) {
                            uiCallTerminated(e.description);
                        }
                        break;
                    } // 'terminating' | 'terminated'

                case 'm_stream_video_local_added':
                    {
                        if (e.session == oSipSessionCall) {
                            uiVideoDisplayEvent(true, true);
                        }
                        break;
                    }
                case 'm_stream_video_local_removed':
                    {
                        if (e.session == oSipSessionCall) {
                            uiVideoDisplayEvent(true, false);
                        }
                        break;
                    }
                case 'm_stream_video_remote_added':
                    {
                        if (e.session == oSipSessionCall) {
                            uiVideoDisplayEvent(false, true);
                        }
                        break;
                    }
                case 'm_stream_video_remote_removed':
                    {
                        if (e.session == oSipSessionCall) {
                            uiVideoDisplayEvent(false, false);
                        }
                        break;
                    }

                case 'm_stream_audio_local_added':
                case 'm_stream_audio_local_removed':
                case 'm_stream_audio_remote_added':
                case 'm_stream_audio_remote_removed':
                    {
                        break;
                    }

                case 'i_ect_new_call':
                    {
                        oSipSessionTransferCall = e.session;
                        break;
                    }

                case 'i_ao_request':
                    {
                        if (e.session == oSipSessionCall) {
                            var iSipResponseCode = e.getSipResponseCode();
                            if (iSipResponseCode == 180 || iSipResponseCode == 183) {
                                startRingbackTone();
                                txtCallStatus.innerHTML = '<i>Remote ringing...</i>';
                            }
                        }
                        break;
                    }

                case 'm_early_media':
                    {
                        if (e.session == oSipSessionCall) {
                            //turns off flashing button
                            // document.getElementById("btnCall").classList.remove("btn-glow");
                            // document.getElementById("btnCall").className = "btn-success";
                            // document.getElementById("btnVideoCall").classList.remove("btn-glow");
                            // document.getElementById("btnVideoCall").className = "btn-success";
                            stopRingbackTone();
                            stopRingTone();
                            txtCallStatus.innerHTML = '<i>Early media started</i>';
                        }
                        break;
                    }

                case 'm_local_hold_ok':
                    {
                        if (e.session == oSipSessionCall) {
                            if (oSipSessionCall.bTransfering) {
                                oSipSessionCall.bTransfering = false;
                                // this.AVSession.TransferCall(this.transferUri);
                            }
                            btnHoldResume.value = 'Resume';
                            btnHoldResume.disabled = false;
                            txtCallStatus.innerHTML = '<i>Call placed on hold</i>';
                            oSipSessionCall.bHeld = true;
                        }
                        break;
                    }
                case 'm_local_hold_nok':
                    {
                        if (e.session == oSipSessionCall) {
                            oSipSessionCall.bTransfering = false;
                            btnHoldResume.value = 'Hold';
                            btnHoldResume.disabled = false;
                            txtCallStatus.innerHTML = '<i>Failed to place remote party on hold</i>';
                        }
                        break;
                    }
                case 'm_local_resume_ok':
                    {
                        if (e.session == oSipSessionCall) {
                            oSipSessionCall.bTransfering = false;
                            btnHoldResume.value = 'Hold';
                            btnHoldResume.disabled = false;
                            txtCallStatus.innerHTML = '<i>Call taken off hold</i>';
                            oSipSessionCall.bHeld = false;

                            if (SIPml.isWebRtc4AllSupported()) { // IE don't provide stream callback yet
                                uiVideoDisplayEvent(false, true);
                                uiVideoDisplayEvent(true, true);
                            }
                        }
                        break;
                    }
                case 'm_local_resume_nok':
                    {
                        if (e.session == oSipSessionCall) {
                            oSipSessionCall.bTransfering = false;
                            btnHoldResume.disabled = false;
                            txtCallStatus.innerHTML = '<i>Failed to unhold call</i>';
                        }
                        break;
                    }
                case 'm_remote_hold':
                    {
                        if (e.session == oSipSessionCall) {
                            txtCallStatus.innerHTML = '<i>Placed on hold by remote party</i>';
                        }
                        break;
                    }
                case 'm_remote_resume':
                    {
                        if (e.session == oSipSessionCall) {
                            txtCallStatus.innerHTML = '<i>Taken off hold by remote party</i>';
                        }
                        break;
                    }
                case 'm_bfcp_info':
                    {
                        if (e.session == oSipSessionCall) {
                            txtCallStatus.innerHTML = 'BFCP Info: <i>' + e.description + '</i>';
                        }
                        break;
                    }

                case 'o_ect_trying':
                    {
                        if (e.session == oSipSessionCall) {
                            txtCallStatus.innerHTML = '<i>Call transfer in progress...</i>';
                        }
                        break;
                    }
                case 'o_ect_accepted':
                    {
                        if (e.session == oSipSessionCall) {
                            txtCallStatus.innerHTML = '<i>Call transfer accepted</i>';
                        }
                        break;
                    }
                case 'o_ect_completed':
                case 'i_ect_completed':
                    {
                        if (e.session == oSipSessionCall) {
                            txtCallStatus.innerHTML = '<i>Call transfer completed</i>';
                            btnTransfer.disabled = false;
                            if (oSipSessionTransferCall) {
                                oSipSessionCall = oSipSessionTransferCall;
                            }
                            oSipSessionTransferCall = null;
                        }
                        break;
                    }
                case 'o_ect_failed':
                case 'i_ect_failed':
                    {
                        if (e.session == oSipSessionCall) {
                            txtCallStatus.innerHTML = '<i>Call transfer failed</i>';
                            btnTransfer.disabled = false;
                        }
                        break;
                    }
                case 'o_ect_notify':
                case 'i_ect_notify':
                    {
                        if (e.session == oSipSessionCall) {
                            txtCallStatus.innerHTML = "<i>Call Transfer: <b>" + e.getSipResponseCode() + " " + e.description + "</b></i>";
                            if (e.getSipResponseCode() >= 300) {
                                if (oSipSessionCall.bHeld) {
                                    oSipSessionCall.resume();
                                }
                                btnTransfer.disabled = false;
                            }
                        }
                        break;
                    }
                case 'i_ect_requested':
                    {
                        if (e.session == oSipSessionCall) {
                            var s_message = "Do you accept call transfer to [" + e.getTransferDestinationFriendlyName() + "]?";//FIXME
                            if (confirm(s_message)) {
                                txtCallStatus.innerHTML = "<i>Call transfer in progress...</i>";
                                oSipSessionCall.acceptTransfer();
                                break;
                            }
                            oSipSessionCall.rejectTransfer();
                        }
                        break;
                    }
            }
        }

    </script>
</head>
<body style="cursor:wait">
		<!-- Disable top navigation bar for MAB POC
    <div class="navbar navbar-fixed-top">
        <div id="divNavbarInner" class="navbar-inner">
            <div class="container">
                <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                    <span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
                </a>
                <img alt="sipML5" class="brand" src="./images/sipml-34x39.png" />
                <div class="nav-collapse">
                    <ul class="nav">
                        <li class="active"><a href="index.htmlsvn=236">Home</a></li>
                    </ul>
                </div>
                <!--/.nav-collapse
            </div>
        </div>
    </div>
		-->

    <div class="container">
        <div class="row-fluid">
						<!-- Disable manual SIP registration UI for MAB POC -->
            <!--div class="span4 well">
                <!--img src="data:image/x-icon;base64,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" /-->
                <!--label style="width: 100%;" align="center" id="txtRegStatus">
                </label>
                <h2>
                    Registration
                </h2>
                <br />
                <table style='width: 100%'>
                    <tr>
                        <td>
                            <label style="height: 100%">
                                Display Name:
                            </label>
                        </td>
                        <td>
                            <input type="text" style="width: 100%; height: 100%" id="txtDisplayName" value=""
                                   placeholder="e.g. John Doe" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label style="height: 100%">
                                Private Identity<sup>*</sup>:
                            </label>
                        </td>
                        <td>
                            <input type="text" style="width: 100%; height: 100%" id="txtPrivateIdentity" value=""
                                   placeholder="e.g. +33600000000" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label style="height: 100%">
                                Public Identity<sup>*</sup>:
                            </label>
                        </td>
                        <td>
                            <input type="text" style="width: 100%; height: 100%" id="txtPublicIdentity" value=""
                                   placeholder="e.g. sip:+33600000000@doubango.org" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label style="height: 100%">Password:</label>
                        </td>
                        <td>
                            <input type="password" style="width: 100%; height: 100%" id="txtPassword" value="" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label style="height: 100%">Realm<sup>*</sup>:</label>
                        </td>
                        <td>
                            <input type="text" style="width: 100%; height: 100%" id="txtRealm" value="" placeholder="e.g. doubango.org" />
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2" align="right">
                            <input type="button" class="btn btn-success" id="btnRegister" value="LogIn" disabled onclick='sipRegister();' />
                            &nbsp;
                            <input type="button" class="btn btn-danger" id="btnUnRegister" value="LogOut" disabled onclick='sipUnRegister();' />
                        </td>
                    </tr>
                    <tr>
                        <td colspan="3">
                            <p class="small"><sup>*</sup> <i>Mandatory Field</i></p>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="3">
                            <a class="btn" href="http://code.google.com/p/sipml5/wiki/Public_SIP_Servers" target="_blank">Need SIP account?</a>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="3">
                            <a class="btn" href="./expert.htm" target="_blank">Expert mode?</a>
                        </td>
                    </tr>
                </table>
            </div-->
            <div id="divCallCtrl" class="span7 well" style="background-image: linear-gradient(to right, #535252, #b51cc9, #b51cc9, #b51cc9, #535252);" style='display:table-cell; vertical-align:middle;'>
                <label style="width: 100%;" id="txtCallStatus"></label>
                <h1 style="text-align: center;" id="callIdentity">
                </h1>
                <br />
                <table style='width: 100%;'>
                    <tr>
                        <td style="white-space:nowrap;">
                            <input type="hidden" style="width: 100%; height:100%; align-items: center;" id="txtPhoneNumber"
                                placeholder="Enter phone number to call" />
                            </td>
                            </tr>
                            <tr>
                                <!-- New command button for MAB POC -->
                                <td style=" display: flex; justify-content: center;">
                                    <div id="divCallChoices" style="display: inline-flex; justify-content: center;">
                                        <!--button type="button" class="btn-success" id=" " value="" disabled onclick='sipCall("call-audio");'><svg id="svgPhone" width="20" height="20" fill="currentColor"class="bi bi-telephone-fill" viewBox="0 0 16 16"><path fill-rule="evenodd"d="M1.885.511a1.745 1.745 0 012.61.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 00.178.643l2.457 2.457a.678.678 0 00.644.178l2.189-.547a1.745 1.745 0 011.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 01-7.01-4.42 18.634 18.634 0 01-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511z" /></svg></button-->
                                        <div>
                                            <button type="button" class="btn-success" id="btnCall" value="" disabled><svg id="svgPhone" width="20" height="20" fill="currentColor"class="bi bi-telephone-fill" viewBox="0 0 16 16"><path fill-rule="evenodd"d="M1.885.511a1.745 1.745 0 012.61.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 00.178.643l2.457 2.457a.678.678 0 00.644.178l2.189-.547a1.745 1.745 0 011.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 01-7.01-4.42 18.634 18.634 0 01-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511z" /></svg></button>
                                            &nbsp;
                                        </div>
                                        <!--button type="button" class="btn-success" id="btnVideoCall" value="" disabled onclick='sipCall("call-audiovideo");'><svg id="svgVideo" width="20" height="20" fill="currentColor" class="bi bi-camera-video-fill" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M0 5a2 2 0 0 1 2-2h7.5a2 2 0 0 1 1.983 1.738l3.11-1.382A1 1 0 0 1 16 4.269v7.462a1 1 0 0 1-1.406.913l-3.111-1.382A2 2 0 0 1 9.5 13H2a2 2 0 0 1-2-2V5z"/></svg></button-->
                                        <div>
                                            <button type="button" class="btn-success" id="btnVideoCall" value="" disabled><svg id="svgVideo" width="20" height="20" fill="currentColor" class="bi bi-camera-video-fill" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M0 5a2 2 0 0 1 2-2h7.5a2 2 0 0 1 1.983 1.738l3.11-1.382A1 1 0 0 1 16 4.269v7.462a1 1 0 0 1-1.406.913l-3.111-1.382A2 2 0 0 1 9.5 13H2a2 2 0 0 1-2-2V5z"/></svg></button>
                                            &nbsp;
                                        </div>
                                    </div>
                                        
                                        <div id="divCallOptions" style="display: none;">
                                            <button type="button" class="btn-danger" id="btnHangUp" value="Hang Up" disabled onclick='sipHangUp();'><svg id="svgHangup" width="20" height="20" fill="currentColor" class="bi bi-telephone-x-fill" viewBox="0 0 16 16">
                                                <path fill-rule="evenodd" d="M1.885.511a1.745 1.745 0 0 1 2.61.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 0 0 .178.643l2.457 2.457a.678.678 0 0 0 .644.178l2.189-.547a1.745 1.745 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 0 1-7.01-4.42 18.634 18.634 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511zm9.261 1.135a.5.5 0 0 1 .708 0L13 2.793l1.146-1.147a.5.5 0 0 1 .708.708L13.707 3.5l1.147 1.146a.5.5 0 0 1-.708.708L13 4.207l-1.146 1.147a.5.5 0 0 1-.708-.708L12.293 3.5l-1.147-1.146a.5.5 0 0 1 0-.708z"/>
                                              </svg></button>
                                            &nbsp;
                                            <!-- <button type="button" class="btn-danger" id="btnHangUp" value="Hang Up" disabled onclick='sipHangUp();'><svg id="svgVideo" width="20" height="20" fill="currentColor" class="bi bi-camera-video-fill" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M0 5a2 2 0 0 1 2-2h7.5a2 2 0 0 1 1.983 1.738l3.11-1.382A1 1 0 0 1 16 4.269v7.462a1 1 0 0 1-1.406.913l-3.111-1.382A2 2 0 0 1 9.5 13H2a2 2 0 0 1-2-2V5z"/></svg></button>
                                            &nbsp; -->
                                            <button type="button" class="btn-danger" id="btnMute" value="" onclick='sipToggleMute();' style="background-color: #009; background-image: -moz-linear-gradient(top, #007, #009);
                                                    background-image: -ms-linear-gradient(top, #007, #009);
                                                    background-image: -webkit-gradient(linear, 0 0, 0 100%, from(#007), to(#009));
                                                    background-image: -webkit-linear-gradient(top, #008, #009);
                                                    background-image: -o-linear-gradient(top, #008, #009);
                                                    background-image: linear-gradient(top, #008, #009);" disabled>
                                                    <svg width="20" height="20" fill="currentColor" class="bi bi-mic-mute-fill" viewBox="0 0 16 16">
                                                <path d="M13 8c0 .564-.094 1.107-.266 1.613l-.814-.814A4.02 4.02 0 0 0 12 8V7a.5.5 0 0 1 1 0v1zm-5 4c.818 0 1.578-.245 2.212-.667l.718.719a4.973 4.973 0 0 1-2.43.923V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 1 0v1a4 4 0 0 0 4 4zm3-9v4.879L5.158 2.037A3.001 3.001 0 0 1 11 3z"/>
                                                <path d="M9.486 10.607 5 6.12V8a3 3 0 0 0 4.486 2.607zm-7.84-9.253 12 12 .708-.708-12-12-.708.708z"/>
                                          </svg></button>
                                            &nbsp;
                                        </div>
                                    <!-- <button type="button" class="btn-danger" id="btnHangUp" value="Hang Up" disabled onclick='sipHangUp();'><svg width="20" height="20" fill="currentColor"class="bi bi-x-circle-fill" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z" /></svg></button>
                                    &nbsp; -->
                                    <button type="button" class="btn-danger" id="btnRefresh" value="Refresh" onclick='refreshconnection();'><svg width="20" height="20" fill="currentColor" class="bi bi-arrow-repeat" viewBox="0 0 16 16"><path d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41zm-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9z" /> <path fill-rule="evenodd" d="M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5.002 5.002 0 0 0 8 3zM3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9H3.1z" /> </svg></button>
                                    <!-- <input type="button" class="btn-success" id="btnCall" value="       Call       " disabled onclick='sipCall("call-audio");' />
                                         <input type="button" class="btn-danger" id="btnHangUp" value="     HangUp     " disabled onclick='sipHangUp();' />
                                         <input type="button" class="btn-danger" id="btnRefresh" value="     Refresh     "  onclick='refreshconnection();' /> -->
                                </td>

                                <!-- Disable command button for MAB POC
                                                    <td colspan="1" align="right">
                                                        <div class="btn-toolbar" style="margin: 0; vertical-align:middle">
                                                            <!--div class="btn-group">
                                                                <input type="button" id="btnBFCP" style="margin: 0; vertical-align:middle; height: 100%;" class="btn btn-primary" value="BFCP" onclick='sipShareScreen();' disabled />
                                                            </div>
                                                            <div id="divBtnCallGroup" class="btn-group">
                                    <button id="btnCall" disabled class="btn btn-primary" data-toggle="dropdown">Call</button>
                                </div>&nbsp;&nbsp;
                                <div class="btn-group">
                                    <input type="button" id="btnHangUp" style="margin: 0; vertical-align:middle; height: 100%;" class="btn btn-primary" value="HangUp" onclick='sipHangUp();' disabled />
                                </div>
                            </div>
                        </td>
												-->
                    </tr>
										<tr>
												<!-- <td>
														<label style="height: 100%">Video Call Option:</label>
												</td> -->
												<!-- <td style=" display: flex; justify-content: end;">
													<label class="switch">
                                                        <input type='checkbox' id='cbVideoCall' class="checkbox" />
                                                            <span class="slider round">
                                                                <!-- <svg id="svgVideo" width="36" height="36" fill="currentColor" class="bi bi-camera-video-fill" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M0 5a2 2 0 0 1 2-2h7.5a2 2 0 0 1 1.983 1.738l3.11-1.382A1 1 0 0 1 16 4.269v7.462a1 1 0 0 1-1.406.913l-3.111-1.382A2 2 0 0 1 9.5 13H2a2 2 0 0 1-2-2V5z"/></svg>
                                                                <svg id="svgPhone" width="36" height="36" fill="currentColor"class="bi bi-telephone-fill" viewBox="0 0 24 24"><path fill-rule="evenodd"d="M1.885.511a1.745 1.745 0 012.61.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 00.178.643l2.457 2.457a.678.678 0 00.644.178l2.189-.547a1.745 1.745 0 011.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 01-7.01-4.42 18.634 18.634 0 01-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511z" /></svg>
                                                                 -->
                                                            </span>
                                                    </label>
                                                    <!-- <input type='checkbox' id='cbVideoCall' /> -->

												</td>
										</tr>
										<!-- New text status for MAB POC -->
                    <tr>
                        <td>
                            <label style="width: 100%;" align="left" id="txtRegStatus">
                            </label>
                        </td>
                    </tr>
                    <tr>
                        <td id="tdVideo" class='tab-video'>
                            <div id="divVideo" class='div-video'>
                                <div id="divVideoRemote" style='position:relative; border:1px solid #009; height:100%; width:100%; z-index: auto; opacity: 1'>
                                    <video class="video" width="100%" height="100%" id="video_remote" autoplay="autoplay" style="opacity: 0;
                                        background-color: #000000; -webkit-transition-property: opacity; -webkit-transition-duration: 2s;"></video>
                                </div>

                                <div id="divVideoLocalWrapper" style="margin-left: 0px; border:0px solid #009; z-index: 1000">
                                    <iframe class="previewvideo" style="border:0px solid #009; z-index: 1000"> </iframe>
                                    <div id="divVideoLocal" class="previewvideo" style=' border:0px solid #009; z-index: 1000'>
                                        <video class="video" width="100%" height="100%" id="video_local" autoplay="autoplay" muted="true" style="opacity: 0;
                                            background-color: #000000; -webkit-transition-property: opacity;
                                            -webkit-transition-duration: 2s;"></video>
                                    </div>
                                </div>
                                <div id="divScreencastLocalWrapper" style="margin-left: 90px; border:0px solid #009; z-index: 1000">
                                    <iframe class="previewvideo" style="border:0px solid #009; z-index: 1000"> </iframe>
                                    <div id="divScreencastLocal" class="previewvideo" style=' border:0px solid #009; z-index: 1000'>
                                    </div>
                                </div>
                                <!--div id="div1" style="margin-left: 300px; border:0px solid #009; z-index: 1000">
                                    <iframe class="previewvideo" style="border:0px solid #009; z-index: 1000"> </iframe>
                                    <div id="div2" class="previewvideo" style='border:0px solid #009; z-index: 1000'>
                                      <input type="button" class="btn" style="" id="Button1" value="Button1" /> &nbsp;
                                      <input type="button" class="btn" style="" id="Button2" value="Button2" /> &nbsp;
                                    </div>
                                </div-->
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td align='center'>
                            <div id='divCallOptions' class='call-options' style='opacity: 0; margin-top: 0px'>
                                <!--input type="button" class="btn" style="" id="btnFullScreen" value="FullScreen" disabled onclick='toggleFullScreen();' /> &nbsp;-->
                                <input type="button" class="btn" style="" id="btnHoldResume" value="Hold" onclick='sipToggleHoldResume();' /> &nbsp;
                                <input type="button" class="btn" style="" id="btnTransfer" value="Transfer" onclick='sipTransfer();' /> &nbsp;
                                <input type="button" class="btn" style="" id="btnKeyPad" value="KeyPad" onclick='openKeyPad();' />
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
        </div>

        <br />
        <footer>
						<!-- Comments out for MAB POC -->
            <!--p>
                &copy; Doubango Telecom 2012-2018 <br />
                <i>Inspiring the future</i>
            </p-->

						<!-- <p>&copy; System Consultancy Services Sdn. Bhd. 2021 <br />
            <i>Your Thinking Company</i>
            </p> -->

            <!-- Creates all ATL/COM objects right now
                Will open confirmation dialogs if not already done
            -->
            <!--object id="fakeVideoDisplay" classid="clsid:5C2C407B-09D9-449B-BB83-C39B7802A684" style="visibility:hidden;"> </object-->
            <!--object id="fakeLooper" classid="clsid:7082C446-54A8-4280-A18D-54143846211A" style="visibility:visible; width:0px; height:0px"> </object-->
            <!--object id="fakeSessionDescription" classid="clsid:DBA9F8E2-F9FB-47CF-8797-986A69A1CA9C" style="visibility:hidden;"> </object-->
            <!--object id="fakeNetTransport" classid="clsid:5A7D84EC-382C-4844-AB3A-9825DBE30DAE" style="visibility:hidden;"> </object-->
            <!--object id="fakePeerConnection" classid="clsid:56D10AD3-8F52-4AA4-854B-41F4D6F9CEA3" style="visibility:hidden;"> </object-->
            <object id="fakePluginInstance" classid="clsid:69E4A9D1-824C-40DA-9680-C7424A27B6A0" style="visibility:hidden;"> </object>

            <!--
                NPAPI  browsers: Safari, Opera and Firefox
            -->
            <!--embed id="WebRtc4npapi" type="application/w4a" width='1' height='1' style='visibility:hidden;' /-->
        </footer>
    </div>
    <!-- /container -->
    <!-- Glass Panel -->
    <div id='divGlassPanel' class='glass-panel' style='visibility:hidden'></div>
    <!-- KeyPad Div -->
    <div id='divKeyPad' class='span2 well div-keypad' style="left:0px; top:0px; width:250; height:240; visibility:hidden">
        <table style="width: 100%; height: 100%">
            <tr><td><input type="button" style="width: 33%" class="btn" value="1" onclick="sipSendDTMF('1');" /><input type="button" style="width: 33%" class="btn" value="2" onclick="sipSendDTMF('2');" /><input type="button" style="width: 33%" class="btn" value="3" onclick="sipSendDTMF('3');" /></td></tr>
            <tr><td><input type="button" style="width: 33%" class="btn" value="4" onclick="sipSendDTMF('4');" /><input type="button" style="width: 33%" class="btn" value="5" onclick="sipSendDTMF('5');" /><input type="button" style="width: 33%" class="btn" value="6" onclick="sipSendDTMF('6');" /></td></tr>
            <tr><td><input type="button" style="width: 33%" class="btn" value="7" onclick="sipSendDTMF('7');" /><input type="button" style="width: 33%" class="btn" value="8" onclick="sipSendDTMF('8');" /><input type="button" style="width: 33%" class="btn" value="9" onclick="sipSendDTMF('9');" /></td></tr>
            <tr><td><input type="button" style="width: 33%" class="btn" value="*" onclick="sipSendDTMF('*');" /><input type="button" style="width: 33%" class="btn" value="0" onclick="sipSendDTMF('0');" /><input type="button" style="width: 33%" class="btn" value="#" onclick="sipSendDTMF('#');" /></td></tr>
            <tr><td colspan=3><input type="button" style="width: 100%" class="btn btn-medium btn-danger" value="close" onclick="closeKeyPad();" /></td></tr>
        </table>
    </div>

		<!-- Comments out for MAB POC -->
		<!-- Call button options -->
    <!--ul id="ulCallOptions" class="dropdown-menu" style="visibility:hidden">
        <li><a href="#" onclick='sipCall("call-audio");'>Audio</a></li>
        <li><a href="#" onclick='sipCall("call-audiovideo");'>Video</a></li>
        <li id='liScreenShare'><a href="#" onclick='sipShareScreen();'>Screen Share</a></li>
        <li class="divider"></li>
        <li><a href="#" onclick='uiDisableCallOptions();'><b>Disable these options</b></a></li>
    </ul-->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/javascript" src="./assets/js/jquery.js"></script>
    <script type="text/javascript" src="./assets/js/bootstrap-transition.js"></script>
    <script type="text/javascript" src="./assets/js/bootstrap-alert.js"></script>
    <script type="text/javascript" src="./assets/js/bootstrap-modal.js"></script>
    <script type="text/javascript" src="./assets/js/bootstrap-dropdown.js"></script>
    <script type="text/javascript" src="./assets/js/bootstrap-scrollspy.js"></script>
    <script type="text/javascript" src="./assets/js/bootstrap-tab.js"></script>
    <script type="text/javascript" src="./assets/js/bootstrap-tooltip.js"></script>
    <script type="text/javascript" src="./assets/js/bootstrap-popover.js"></script>
    <script type="text/javascript" src="./assets/js/bootstrap-button.js"></script>
    <script type="text/javascript" src="./assets/js/bootstrap-collapse.js"></script>
    <script type="text/javascript" src="./assets/js/bootstrap-carousel.js"></script>
    <script type="text/javascript" src="./assets/js/bootstrap-typeahead.js"></script>

    <!-- Audios -->
    <audio id="audio_remote" autoplay="autoplay"> </audio>
    <audio id="ringtone" loop src="sounds/ringtone.wav"> </audio>
    <audio id="ringbacktone" loop src="sounds/ringbacktone.wav"> </audio>
    <audio id="dtmfTone" src="sounds/dtmf.wav"> </audio>

    <!-- GOOGLE ANALYTICS -->
    <!--script type="text/javascript">
        var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
        document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script-->

    <script type="text/javascript">
        try {
            var pageTracker = _gat._getTracker("UA-6868621-19");
            pageTracker._trackPageview();
        } catch (err) { }
    </script>

</body>
</html>
